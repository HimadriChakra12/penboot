#!/bin/bash
set -e

# Detect --noconfirm flag
NOCONFIRM_FLAG=""
if [[ "$1" == "--noconfirm" || "$1" == "-y" ]]; then
    NOCONFIRM_FLAG="--noconfirm"
fi

# Ensure git is available
if ! command -v git &>/dev/null; then
    echo "Error: git is not installed."
    exit 1
fi

# Clone or update repo
if [ ! -d "$HOME/penboot" ]; then
    echo "Cloning Himarchy..."
    git clone "https://github.com/himadrichakra12/penboot.git" "$HOME/penboot"
else
    echo "Updating Himarchy..."
    cd "$HOME/penboot" || exit 1
    git pull --rebase --autostash
fi

cd "$HOME/penboot"

if [ "$(pwd)" == "$HOME/penboot" ]; then
	# Run scripts
	echo "Configuring symlinks"
	bash ./scripts/symlink.sh
	echo "Disabling KDE Animations"
	bash ./scripts/kdeanim.sh 
	echo "KDE debloat"
	bash ./scripts/kdebloat.sh 
	echo "Firefox fixup"
	bash ./scripts/firefox.sh 
	echo "Installing packages"
	bash ./scripts/packages.sh "$NOCONFIRM_FLAG"
else
	echo "Configuring symlinks"
	bash $HOME/penboot/scripts/symlink.sh
	echo "Disabling KDE Animations"
	bash $HOME/penboot/scripts/kdeanim.sh 
	echo "KDE debloat"
	bash $HOME/penboot/scripts/kdebloat.sh 
	echo "Firefox fixup"
	bash $HOME/penboot/scripts/firefox.sh 
	echo "Installing packages"
	bash $HOME/penboot/scripts/packages.sh "$NOCONFIRM_FLAG"
fi

